<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_crm_call_detail_list" model="ir.ui.view">
            <field name="name">crm.call.detail.list</field>
            <field name="model">crm.call.detail</field>
            <field name="arch" type="xml">
                <list string="Call Details" editable="bottom">
                    <field name="call_date"/>
                    <field name="call_timing"/>
                    <field name="user_id"/>
                    <field name="call_type"/>
                    <field name="duration" widget="float_time"/>
                    <field name="subject"/>
                    <field name="notes"/>
                </list>
            </field>
        </record>

        <record id="view_crm_call_detail_form" model="ir.ui.view">
            <field name="name">crm.call.detail.form</field>
            <field name="model">crm.call.detail</field>
            <field name="arch" type="xml">
                <form string="Call Detail">
                    <sheet>
                        <group>
                            <group>
                                <field name="user_id"/>
                                <field name="call_date"/>
                                <field name="call_timing"/>
                            </group>
                            <group>
                                <field name="call_type"/>
                                <field name="duration" widget="float_time"/>
                                <field name="subject"/>
                            </group>
                        </group>
                        <group>
                            <field name="notes" placeholder="Add notes about this call..."/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_crm_lead_form_call_details" model="ir.ui.view">
            <field name="name">crm.lead.form.call.details</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_lead_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//notebook" position="inside">
                    <page name="call_details" string="Call Details">
                        <group>
                            <group>
                                <field name="call_count" readonly="1"/>
                                <field name="last_call_date" readonly="1"/>
                            </group>
                        </group>
                        <field name="call_detail_ids">
                            <list editable="bottom">
                                <field name="call_date"/>
                                <field name="call_timing"/>
                                <field name="user_id"/>
                                <field name="call_type"/>
                                <field name="duration" widget="float_time"/>
                                <field name="subject"/>
                                <field name="notes"/>
                            </list>
                        </field>
                    </page>
                </xpath>
                
                <xpath expr="//div[@name='button_box']" position="inside">
                    <button name="action_view_calls" 
                            type="object" 
                            class="oe_stat_button" 
                            icon="fa-phone"
                            invisible="call_count == 0">
                        <field name="call_count" widget="statinfo" string="Calls"/>
                    </button>
                </xpath>
            </field>
        </record>

        <record id="view_crm_lead_list_call_count" model="ir.ui.view">
            <field name="name">crm.lead.list.call.count</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_tree_view_oppor"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='expected_revenue']" position="after">
                    <field name="call_count" optional="hide"/>
                    <field name="last_call_date" optional="hide"/>
                </xpath>
            </field>
        </record>

    </data>
</odoo>